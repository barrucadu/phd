\documentclass[openright, dottedtoc, headinclude, footinclude=true, a4paper, numbers=noenddot, fontsize=10pt]{scrreprt}

\title{D\'{e}j\`{a} Fu Technical Report}
\author{Michael Walker}

%TC:group minted      [ignore] xall
%TC:group haskellcode [ignore] xall

% Stuff cargo-culted from jmct's thesis
\usepackage[eulermath, pdfspacing]{classicthesis}

\usepackage{setspace}
\onehalfspacing

\usepackage{graphicx}
\usepackage{caption}
\usepackage{mathtools}
\usepackage{fancyvrb}
\usepackage{hyperref}
\usepackage{subcaption}
\usepackage{alltt}
\usepackage{color}

\usepackage{microtype}
\usepackage{xargs}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{latexsym}
\usepackage{textcomp}
\usepackage{multicol}
\usepackage{multirow}
\usepackage{url}
\usepackage{siunitx}
\usepackage{appendix}
\usepackage{nomencl}
\usepackage[top=3cm,bottom=3cm]{geometry}

\usepackage{tikz}

\usepackage{csquotes}

\usepackage{minted}
\usemintedstyle{trac}
\newminted{haskell}{}

\usepackage{haskell}

\usepackage[vlined, boxed]{algorithm2e}

\hypersetup{
 colorlinks,
 citecolor=Red,
 linkcolor=Black,
 urlcolor=Blue
}

\usepackage[square]{natbib}

% Definitions

\newcommand{\defineword}[2]{%
\begin{description}%
    \item{\textbf{#1}} \hfill \\%
        {#2}%
\end{description}%
}

\newcommand{\definewordc}[3]{%
\begin{description}%
    \item{\textbf{#1}} \citep{#2}\hfill \\%
        {#3}%
\end{description}%
}

% Front-matter

\usepackage{tocloft}
\setcounter{tocdepth}{1}

\DeclareCaptionFormat{myformat}{#1#2#3\hrulefill}
\DeclareCaptionFormat{fnoline}{#1#2#3}
\captionsetup[figure]{format=myformat}

\newcommand{\frontmatter}{\cleardoublepage\pagenumbering{roman}}

\newcommand{\mainmatter}{\cleardoublepage\pagenumbering{arabic}}

% Chapter quotes

\makeatletter
\newenvironment{chapquote}[2][2em]
  {\setlength{\@tempdima}{#1}%
   \def\chapquote@author{#2}%
   \parshape 1 \@tempdima \dimexpr\textwidth-2\@tempdima\relax%
   \itshape}
  {\par\normalfont\hfill--\
    \chapquote@author\hspace*{\@tempdima}\par\noindent\hrulefill\\[1cm]}
\makeatother

% Todo notes
\usepackage[colorinlistoftodos,prependcaption,textsize=small]{todonotes}
\let\marginpar\oldmarginpar

\newcommandx{\tocite}[2][1=]{\todo[linecolor=red,backgroundcolor=red!25,bordercolor=red,#1]{Cite: #2}}
\newcommandx{\todoinline}[1]{\todo[inline]{#1}}
\newcommandx{\todofig}[1]{\todo[inline]{Make figure: #1}}

% Departures in \chap{abstraction}:
\usepackage{framed}
\usepackage{amsthm}

\newenvironment{justspacing}{%
\def\FrameCommand{\hspace{0pt}}%
\MakeFramed {\advance\hsize-\width \FrameRestore}}%
{\endMakeFramed}

\newenvironment{departure}%
{\begin{justspacing}%
\noindent%
\paragraph{Departure}}%
{\hfill $\qed$ \end{justspacing}}

% Landscape pages
\usepackage{pdflscape}

% Misc
\newcommand{\quot}[2]{``\textit{#1}'' \cite{#2}}
\newcommand{\sect}[2]{\S\ref{sec:#1-#2}}
\newcommand{\chap}[1]{Chapter \ref{chap:#1}}
\newcommand{\dejafu}{D\'{e}j\`{a} Fu}
\newcommand{\defineprim}[3]{\defineword{#1 \textit{#2}}{#3}}
\newcommand{\dependent}{\nleftrightarrow}
\newcommand{\arr}{$\rightarrow$ }
\newcommand{\hackage}[1]{\url{https://hackage.haskell.org/package/#1}}
\newcommand{\github}[2]{\url{https://github.com/#1/#2}}
\newcommand{\dom}[1]{\mathbf{dom}~#1}
\newcommand{\ran}[1]{\mathbf{ran}~#1}
\newcommand{\wellf}[1]{\mathbf{well\_formed}~#1}

\begin{document}

\frontmatter

\begin{titlepage}
\begin{center}

\textsc{\Huge \dejafu{} Technical Report}\\[0.25cm]

\large{\github{barrucadu}{dejafu}}\\[0.5cm]

\textsc{\LARGE Michael Walker}
\end{center}

\vspace{3.5cm}

\centerline{\rule{40pt}{1pt} \textsc{\large Abstract} \rule{40pt}{1pt}}
\vspace{0.1cm}

Out of work in the formal verification and model checking field has
grown the topic of \emph{systematic concurrency testing} (SCT), also
known as \emph{stateless model checking}. This technique allows the
reliable, deterministic, and rigorous testing of concurrent programs,
and has enjoyed some success in the imperative and object-oriented
settings. We propose that the functional world could also benefit from
systematic concurrency testing, as GHC Haskell in particular provides
a very rich set of concurrency primitives.

We have developed a library for writing testable concurrent Haskell
programs, using a typeclass-abstraction to select based on the context
of use the concrete implementation to use: the runtime-provided
primitives, or emulated versions provided as part of a testing
framework.

This report discusses the design and implementation of this library,
called \dejafu{}, including some case studies and the community
reception of the initial version presented at the 2015 Haskell
Symposium.

\vspace{0.1cm}
\centerline{\rule{130pt}{1pt}}

\vfill

\begin{center}
Department of Computer Science\par
University of York \\[1,3cm]

November 2015
\end{center}
\end{titlepage}

\tableofcontents

%\listoffigures
%\listoftables

\mainmatter

\chapter{Introduction}
\label{chap:intro}
\begin{chapquote}{Terry Pratchett, Thief of Time\nocite{pratchett2001}}
  [\dejafu{} is] A martial art in which the user's limbs move in time
  as well as space, [\ldots] It is best described as ``the feeling
  that you have been kicked in the head this way before''.
\end{chapquote}

\input{introduction/preamble.tex}

  \section{Parallelism vs Concurrency}
  \label{sec:intro-parconc}
  \input{introduction/parconc.tex}

  \section{Testing Concurrent Programs}
  \label{sec:intro-testing}
  \input{introduction/testing.tex}

  \section{Scope}
  \label{sec:intro-scope}
  \input{introduction/scope.tex}

  \section{Goals \& Contributions}
  \label{sec:intro-contribs}
  \input{introduction/contribs.tex}

  \section{Report Roadmap}
  \label{sec:intro-roadmap}
  \input{introduction/roadmap.tex}

\null\clearpage
\chapter{Concurrency Abstraction}
\label{chap:abstraction}
\input{abstraction/preamble.tex}

  \section{The \texttt{MonadConc} Typeclass}
  \label{sec:abstraction-typeclass}
  \input{abstraction/typeclass.tex}

  \section{Software Transactional Memory}
  \label{sec:abstraction-stm}
  \input{abstraction/stm.tex}

  \section{Memory Model}
  \label{sec:abstraction-mem}
  \input{abstraction/mem.tex}

\null\clearpage
\chapter{Program Execution}
\label{chap:execution}
\input{execution/preamble.tex}

  \section{Primitive Actions}
  \label{sec:execution-primops}
  \input{execution/primops.tex}

  \section{Stepwise Execution}
  \label{sec:execution-stepwise}
  \input{execution/stepwise.tex}

  \section{Scheduling}
  \label{sec:execution-scheduling}
  \input{execution/scheduling.tex}

\null\clearpage
\chapter{Systematic Concurrency Testing}
\label{chap:sct}
\input{sct/preamble.tex}

  \section{Schedule Bounding}
  \label{sec:sct-bounding}
  \input{sct/bounding.tex}

  \section{Partial-order Reduction}
  \label{sec:sct-por}
  \input{sct/por.tex}

\null\clearpage
\chapter{Correctness}
\label{chap:correctness}
\input{correctness/preamble.tex}

  \section{Of Execution}
  \label{sec:correctness-execution}
  \input{correctness/execution.tex}

  \section{Of Testing}
  \label{sec:correctness-testing}
  \input{correctness/testing.tex}

\null\clearpage
\chapter{Case Studies}
\label{chap:casestudies}
\input{casestudies/preamble.tex}

  \section{auto-update}
  \label{sec:casestudies-autoupdate}
  \input{casestudies/autoupdate.tex}

  \section{Search Party}
  \label{sec:casestudies-searchparty}
  \input{casestudies/searchparty.tex}

  \section{The Par Monad}
  \label{sec:casestudies-parmonad}
  \input{casestudies/parmonad.tex}

\null\clearpage
\chapter{Practical Usage}
\label{chap:practice}
\input{practice/preamble.tex}

  \section{Integration with Testing Frameworks}
  \label{sec:practice-integration}
  \input{practice/integration.tex}

  \section{Alternatives to Existing Libraries}
  \label{sec:practice-alternatives}
  \input{practice/alternatives.tex}

\null\clearpage

\chapter{Future Research \& Conclusions}
\label{chap:conclusions}
\input{conclusions/preamble.tex}

  \section{Community Reception}
  \label{sec:conclusions-reception}
  \input{conclusions/reception.tex}

  \section{Related Work}
  \label{sec:conclusions-related}
  \input{conclusions/related.tex}

  \section{Future Work}
  \label{sec:conclusions-future}
  \input{conclusions/future.tex}

\if@openright
  \cleardoublepage
\else
  \clearpage
\fi

\bibliography{references}
\bibliographystyle{plainnat}

\end{document}